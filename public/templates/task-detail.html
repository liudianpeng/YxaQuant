<h2>任务详情</h2>
<div class="row">
    <div class="col-md-2">
        <div class="label label-success" ng-if='task.status=="in progress"'>交易中</div>
        <div class="label label-warning" ng-if='task.status=="paused"'>暂停</div>
        <div class="label label-danger" ng-if='task.status=="canceled"'>取消</div>
    </div>      
    <div class="col-md-10">
        <div class="progress">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100" style="width: {{task.progress*100}}%">
                <span class="sr-onlyY">{{task.progress*100}}%</span>
            </div>
        </div>
    </div>      
</div>

<div class="row">
    <div class="col-md-6">
        开始时间：
        <input type="text"  data-template="dropdown"
             data-show-seconds="true" data-default-time="{{task.timeStart}}" 
             ng-model='task.timeStart'
             data-show-meridian="false" 
             data-minute-step="5">
    </div>      
    <div class="col-md-6">
        结束时间：
        <input type="text" timepicker template="dropdown"
             show-seconds="true" default-time="task.timeEnd" 
             ng-model='task.timeEnd'
             show-meridian="false" 
             dataminute-step="5">
    </div>      
    <div class="col-sm-12">
            

        <div class="panel panel-info" style="margin-bottom: 5em;" ng-repeat='stock in task.stocks' ng-init='stock.showAccount=false'>
            <div class="panel-heading">
                <div class="panel-title"  ng-click="stock.showAccount=!stock.showAccount">
                    <i class="fa fa-arrow-right" ng-class='{"fa-arrow-down": stock.showAccount}'></i>
                    <h3 style="display: inline-block;" ng-bind="stock.name"> </h3>
                    <div class="label label-info" ng-bind="stock.code"></div>
                </div>
                <div class="pull-right" style="margin: 10px 10px 0 0;">
                    ￥<input type="number" style="width: 80px" ng-model="stock.rules.lowestPrice" />~
                    <input type="number" style="width: 80px" ng-model="stock.rules.highestPrice" />, 
                    <input type="number" style="width: 50px" ng-model="stock.rules.timeStep" />S
                </div>
            </div>
            <div class="panel-body no-padding" ng-show="stock.showAccount">
                <table class="table table-bordered datatable table-hover">
                    <tbody>
                        <tr>
                            <td rowspan="2" width="400">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100" style="width: {{ (sumup(stock.accounts, 'volumeCompleted')*100/sumup(stock.accounts, 'volume')) | number:0 }}%">
                                        <span class="sr-onlyY" ng-bind=" ((sumup(stock.accounts, 'volumeCompleted')*100/sumup(stock.accounts, 'volume')) | number:0) + '%'"></span>
                                    </div>
                                </div>
                            </td>
                            <td>已成交股数：</td>
                            <td ng-bind="sumup(stock.accounts, 'volume')"></td>
                            <td>已成交金额：</td>
                            <td ng-bind="sumup(stock.accounts, 'volumeCompleted')"></td>
                        </tr>
                        <tr>
                            <td>总交股数：</td>
                            <td ng-bind="stock.volume"></td>
                            <td>总金额：</td>
                            <td ng-bind="stock.amount"></td>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-bordered datatable" ng-repeat="account in stock.accounts">
                    <tbody>
                        <tr>
                            <td>
                                <h4 style="display: inline-block;">{{account.name}}</h4>
                                <div class="label label-default" ng-bind="account.code"></div>
                            </td>
                            <td> ￥<input type="number" style="width: 60px" ng-model="account.rules.lowestPrice" />~
                            <input type="number" style="width: 60px" ng-model="account.rules.highestPrice" /></td>
                            <td><input type="number" style="width: 60px" ng-model="account.rules.timeStep" />S</td>
                        </tr>
                        <tr>
                            <td>总：{{account.volume}}</td>
                            <td ng-click="account.showDeclarations=true;account.showTransactions=false"
                                style="{{account.showDeclarations ? 'background: #ccc;':''}}"
                            ><span class="badge">申</span>：{{account.volumeDeclared}}</td>
                            <td rowspan="2" style="vertical-align: middle;width: 500px;">

                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" style="width: {{100*account.volumeCompleted/account.volume | number:0}}%">
                                        <span class="sr-onlyY">{{100*account.volumeCompleted/account.volume | number:0}}% (已) </span>
                                    </div>
                                    <div class="progress-bar progress-bar-warning" style="width: {{100*account.volumeDeclared/account.volume | number:0}}%">
                                        <span class="sr-onlyY">{{100*account.volumeDeclared/account.volume | number:0}}% (申) </span>
                                    </div>
                                    <div class="progress-bar progress-bar-danger" style="width: {{100*account.volumeTodo/account.volume | number:0}}%">
                                        <span class="sr-onlyY">{{100*account.volumeTodo/account.volume | number:0}}% (待)</span>
                                    </div>
                                </div>

                            </td>
                        </tr>
                        <tr>
                            <td ng-click="account.showTransactions=true;account.showDeclarations=false"
                                style="{{account.showTransactions ? 'background: #ccc;':''}}"
                                ><span class="badge">成</span>：{{account.volumeCompleted}}</td>
                            <td>待：{{account.volumeTodo}}</td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <table class="table table-bordered datatable" ng-show="account.showDeclarations" >
                                    <thead>
                                        <tr>
                                            <th>股票</th>
                                            <th>代码</th>
                                            <th>时间</th>
                                            <th>帐户</th>
                                            <th>数量</th>
                                            <th>状态</th>
                                            <th>金额</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="declaration in account.declarations">
                                            <td ng-bind="stock.name"></td>
                                            <td ng-bind="stock.code"></td>
                                            <td ng-bind="showItem.time"></td>
                                            <td ng-bind="account.name"></td>
                                            <td ng-bind="declaration.volume"></td>
                                            <td ng-bind="declaration.status"></td>
                                            <td ng-bind="declaration.amount"></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <table class="table table-bordered datatable" ng-show="account.showTransactions"  >
                                    <thead>
                                        <tr>
                                            <th>股票</th>
                                            <th>代码</th>
                                            <th>时间</th>
                                            <th>帐户</th>
                                            <th>数量</th>
                                            <th>金额</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="transaction in account.transactions">
                                            <td ng-bind="stock.name"></td>
                                            <td ng-bind="stock.code"></td>
                                            <td ng-bind="showItem.time"></td>
                                            <td ng-bind="account.name"></td>
                                            <td ng-bind="transaction.volume"></td>
                                            <td ng-bind="transaction.amount"></td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <div class="col-sm-12">
        <button type="submit" ng-click='save()' class="btn btn-success btn-lg">修改</button>
        <button type="submit" ng-click='pause()' class="btn btn-warning btn-lg">暂停</button>
        <button type="submit" ng-click='cancel()' class="btn btn-danger btn-lg">取消</button>
    </div>
</div>